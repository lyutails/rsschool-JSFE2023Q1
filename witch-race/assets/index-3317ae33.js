(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const j=["maple","spruce","elder","birch","pine","cedar","sakura","sequoia","whomping willow","oak","appletree","aspen","bamboo","rosehip","nickel","ivy"],Q=["2000","Repaired","Gold","Access","Way","Thorns","Elven","Twist","Rooftop","2023","Twice Repaired","Platina","Sparkles","Marathon","Wind's Wings","Wind's Song","Scorpion","Meow","Waterproof","Firebreath","Glitch","No Trace","Pick","Naked","Hurricane","Silent","Dragon"],D=["Nimbus","School Broomstick","Firebolt","Phantom","Moonlight Strike","Ghost Broom","Silverrain","Tashenka","Cherry","Tornado","Abyss","Tails","Butterfly","Colibri","Night Star","Myth","Crab","Phenomenon","Salute","Rumours","Raven"];class o{constructor({tagName:t,classList:e=[""],textContent:s="",children:n=[]}){this.append=(...a)=>{this.node.append(...a.map(m=>m.node))},this.node=document.createElement(t??"div"),this.node.classList.add(...e),this.node.textContent=s,n.length&&this.append(...n)}destroy(){this.node.remove()}addTextContent(t){this.node.textContent=t}addMoreClasses(t){this.node.classList.add(t)}removeClass(t){this.node.classList.remove(t)}toggleClass(t){this.node.classList.toggle(t)}addLink(t){this.node.setAttribute("href",t)}setPlaceholder(t){this.node.setAttribute("placeholder",t)}randomizeOwl(t){return t[Math.floor(Math.random()*t.length)]}disableButton(){this.node.setAttribute("disabled","")}enableButton(){this.node.removeAttribute("disabled")}setCursorPointer(){this.node.hasAttribute("disabled")&&(this.node.style.cursor="pointer"),this.node.style.cursor="default"}getRandomName(){const t=D[Math.floor(Math.random()*D.length)],e=Q[Math.floor(Math.random()*Q.length)],s=j[Math.floor(Math.random()*j.length)];return`${t} ${e} ${s}`}getRandomColor(){const t="0123456789abcdef";let e="#";for(let s=0;s<6;s++)e+=t[Math.floor(Math.random()*16)];return e}ifInputName(t){return t===""?this.getRandomName():t}}class K extends o{constructor(){super({tagName:"div",classList:["brooms_parking"]});const t=new o({tagName:"div",classList:["parking_sign"]}),e=new o({tagName:"div",classList:["parking_cat"]}),s=new o({tagName:"div",classList:["brooms_wrapper"],children:[t,e]});this.node.append(s.node)}}class _ extends o{constructor(){super({tagName:"div",classList:["not_found"]});const t=new o({tagName:"div",classList:["not_found_wrapper"],textContent:"Highly likely you got lost in the castle - try another staircase leading to the quidditch field, brooms parking or winners room."});this.node.append(t.node)}}class y{constructor(){this.observers=[]}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(e=>e!==t)}notify(t){this.observers.forEach(e=>{e(t)})}}const J=new y,h={_currentWitches:4,currentWitchesObserver:J,_indexForUpdate:0,_currentUpdate:0,_currentPage:1,_currentWinnersPage:1,set currentWitches(r){this._currentWitches=r,this.currentWitchesObserver.notify("lalala")},get currentWitches(){return this._currentWitches},set indexForUpdate(r){this._indexForUpdate=r},get indexForUpdate(){return this._indexForUpdate},set currentUpdate(r){this._currentUpdate=r,this.currentWitchesObserver.notify("lalala")},get currentUpdate(){return this._currentUpdate},set currentPage(r){this._currentPage=r,this.currentWitchesObserver.notify("lalala")},get currentPage(){return this._currentPage},set currentWinnersPage(r){this._currentWinnersPage=r},get currentWinnersPage(){return this._currentWinnersPage}};class Y extends o{constructor(){super({tagName:"div",classList:["brooms_count"]}),this.node.textContent="Currently total brooms' count is paste-here-number."}}const N=new Y;class z extends o{constructor(){super({tagName:"button",classList:["control_widget_button"]})}}class l extends o{constructor(){super({tagName:"div",classList:["control_widget"]}),l.controlName=new o({tagName:"input",classList:["control_widget_name"]}),l.controlName.setPlaceholder("Imagine Name"),l.controlName.node.value="",l.controlName.node.setAttribute("type","text"),l.controlColor=new o({tagName:"input",classList:["control_widget_color"]}),l.controlColor.node.setAttribute("type","color"),l.controlColor.node.value="#55c6a8",l.controlButton=new z,l.controlButton.node.textContent="Create",this.node.append(l.controlName.node,l.controlColor.node,l.controlButton.node)}}var g=(r=>(r.Quidditch="quidditch",r.BroomParking="brooms_parking",r.Winners="winners",r.NotFound="404",r))(g||{}),E=(r=>(r.garage="/garage",r.winners="/winners",r.engine="/engine",r))(E||{});const F="http://127.0.0.1:3000",v=`${F}${E.garage}`,Z=`${F}${E.winners}`,q=`${F}${E.engine}`,R="7",$=[{key:"_page",value:`${h.currentPage}`},{key:"_limit",value:R}],V="10";`${h.currentWinnersPage}`;const tt=async r=>{try{const e=await fetch(`${v}?${(n=>n.map(a=>`${a.key}=${a.value}`).join("&"))(r)}`);if(!e.ok)throw new Error("some error happened on the way");return await e.json()}catch{throw new Error("smth wrong went with getting all witches")}},H=async(r,t)=>{try{await fetch(`${v}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,color:t})})}catch{throw new Error("smth wrong went with creating witch")}},et=async(r,t,e)=>{try{return fetch(`${v}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,color:t})})}catch{throw new Error("smth wrong went with updating witch")}},nt=async r=>{await fetch(`${q}?&id=${r}&status=stopped`,{method:"PATCH"}).then(t=>t.json()).catch(()=>{throw new Error("smth went wrong here")})};async function U(r){return(await fetch(`${q}?id=${r}&status=drive`,{method:"PATCH"})).json()}const G=async r=>fetch(`${q}?id=${r}&status=started`,{method:"PATCH"}).then(t=>t.json()).then(t=>t).catch(()=>{throw new Error("smth went wrong here")}),ot=async r=>await(await fetch(`${v}/${r}`,{method:"DELETE"})).json(),x=async()=>{const r=fetch(`${v}?&_page=1&_limit=7`);if(!r)throw new Error("no witches found");return r.then(e=>e.headers.get("X-Total-Count")||"0")},st=async()=>{const r=fetch(`${Z}?&_page=1&_limit=10`);if(!r)throw new Error("no witches found");return r.then(e=>e.headers.get("X-Total-Count")||"0")};class d extends o{constructor(){super({tagName:"div",classList:["control_widget"]}),d.controlName=new o({tagName:"input",classList:["control_widget_name"]}),d.controlName.setPlaceholder("Customize Name"),d.controlName.node.setAttribute("type","text"),d.controlColor=new o({tagName:"input",classList:["control_widget_color"]}),d.controlColor.node.setAttribute("type","color"),d.controlColor.node.value="#55c6a8",d.controlButton=new z,d.controlButton.node.textContent="Update",d.controlButton.node.onclick=()=>{d.updateWitchHandler()},this.node.append(d.controlName.node,d.controlColor.node,d.controlButton.node)}static updateWitchHandler(){et(`${d.controlName.node.value}`,`${d.controlColor.node.value}`,h.indexForUpdate),setTimeout(()=>{d.controlName.node.value=""},100),h.currentUpdate+=1}}class rt extends o{constructor(){super({tagName:"div",classList:["control_panel"]});const t=new l,e=new d;this.node.append(t.node,e.node)}}class u extends o{constructor(){super({tagName:"div",classList:["race_buttons"]}),u.raceButton=new o({tagName:"button",classList:["race_buttons_button"],textContent:"Race"}),u.resetButton=new o({tagName:"button",classList:["race_buttons_button"],textContent:"Reset"}),u.moreWitchesButton=new o({tagName:"button",classList:["race_buttons_button"],textContent:"More Witches"}),this.node.append(u.raceButton.node,u.resetButton.node,u.moreWitchesButton.node)}}class k extends o{constructor(){super({tagName:"button",classList:["track_buttons_button"]})}}const M=new y,C=new y,O=new y;class at extends o{constructor(){super({tagName:"div",classList:["track_buttons"]}),this.flyButton=new k,this.flyButton.node.textContent="Fly",this.backButton=new k,this.backButton.node.textContent="Back",this.backButton.disableButton(),this.pickButton=new k,this.pickButton.node.textContent="Pick",this.delButton=new k,this.delButton.node.textContent="Del",this.node.append(this.flyButton.node,this.backButton.node,this.pickButton.node,this.delButton.node),M.subscribe(()=>{this.flyButton.disableButton(),this.backButton.disableButton(),this.pickButton.disableButton(),this.delButton.disableButton()}),C.subscribe(()=>{this.backButton.enableButton(),this.pickButton.enableButton(),this.delButton.enableButton()}),O.subscribe(()=>{this.flyButton.enableButton(),this.backButton.disableButton()})}}class it extends o{constructor(){super({tagName:"div",classList:["track"]})}}class ct extends o{constructor(){super({tagName:"div",classList:["witch"]})}}class dt extends o{constructor(){super({tagName:"div",classList:["owl"]})}}const ut="/lyutails-JSFE2023Q1/witch-race/assets/halloween-horror-owl-1ecda387.svg",lt="/lyutails-JSFE2023Q1/witch-race/assets/halloween-horror-owl_polar-234b501c.svg",ht=[ut,lt];class W extends o{constructor(){super({tagName:"div",classList:["imagined_name_modal"],textContent:"you skipped imagining name then now lalala is the name"}),W.cross=new o({tagName:"div",classList:["cross"]}),this.node.append(W.cross.node),document.body.append(this.node)}}class A extends o{constructor(){super({tagName:"div",classList:["overlay"]}),document.body.append(this.node)}}class b extends o{constructor(){super({tagName:"div",classList:["winner_modal"]}),b.winnerModalText=new o({tagName:"div",classList:["winner_modal_text"]}),b.cross=new o({tagName:"div",classList:["winner_cross"]}),this.node.append(b.winnerModalText.node,b.cross.node)}}const P=new y,mt=new y,I=new y,p=class p extends o{constructor(){super({tagName:"div",classList:["track_wrapper"]}),this.store=h,this.countWitchesAfterDelete=async(t,e,s)=>{try{if(!await x())throw new Error("no witches encounted");t.delButton.node.onclick=a=>this.countWitches(a,e,s)}catch{throw new Error("smth went wrotn with count after delete")}},J.subscribe(()=>{setTimeout(()=>{this.render()},100)}),setTimeout(()=>{this.render()},100),u.raceButton.node.addEventListener("click",this.flyActuallyAllWitches)}render(){this.node.textContent="";const{currentWitches:t}=this.store;p.witchesArrayHTML=[],tt($).then(e=>e.forEach(s=>{const n=new ct,a=new dt;a.node.style.backgroundImage=`url('${a.randomizeOwl(ht)}')`,p.broomWitchName=new o({tagName:"div",classList:["track_broom_witch_name"]});const m=new o({tagName:"div",classList:["track_path"],children:[n,a]}),B=new it,w=new at,X=new o({tagName:"div",classList:["track_buttons_and_name"],children:[w,p.broomWitchName]});n.node.style.backgroundColor=s.color,p.broomWitchName.node.textContent=s.name,n.node.id=String(s.id),w.pickButton.node.id=String(s.id),this.node.append(m.node,B.node,X.node),w.pickButton.node.onclick=f=>this.pickWitch(f,s),w.flyButton.node.onclick=f=>{this.flyWitch(f,n,s.id),P.notify(this.disableButtons()),M.notify("lalala"),u.raceButton.disableButton(),window.addEventListener("animationend",()=>{p.enablePagination(),mt.notify(this.enableButtons()),C.notify("lalala"),u.raceButton.enableButton()})},w.backButton.node.onclick=f=>{this.flyBack(f,n),O.notify("lalala"),I.notify("lalala")},u.raceButton.node.addEventListener("click",()=>{P.notify(this.disableButtons()),M.notify("lalala"),u.raceButton.disableButton(),window.addEventListener("animationend",()=>{this.enableButtons(),C.notify("lalala")})}),u.resetButton.node.addEventListener("click",()=>{n.node.style.animation="unset",O.notify("lalala")}),this.countWitchesAfterDelete(w,s.id,t),p.witchesArrayHTML.push(n)})),l.controlButton.node.onclick=()=>{this.createWitchByClickOnCreate()},u.moreWitchesButton.node.onclick=()=>this.plusWitches()}static async getTime(t,e){const s=await G(t).then(a=>a.velocity),n=+window.innerWidth*.8/+s;return e.node.style.animationDuration=`${+window.innerWidth*.8/+s}s`,n}async flyActuallyAllWitches(){const t=await Promise.all(p.witchesArrayHTML.map(async n=>{try{const a=p.getTime(+n.node.id,n);return n.node.style.animationName="witch_fly_anim",n.node.style.animationIterationCount="1",n.node.style.animationFillMode="forwards",n.node.style.animationTimingFunction="ease-in-out",await U(+n.node.id),{id:+n.node.id,wins:1,time:parseFloat((await a).toFixed(2))}}catch{n.node.style.animationPlayState="paused"}finally{nt(+n.node.id),i.paginationButtonBeginning.enableButton(),i.paginationButtonLeft.enableButton(),i.paginationButtonRight.enableButton(),i.paginationButtonEnd.enableButton(),u.resetButton.enableButton(),u.moreWitchesButton.enableButton(),l.controlButton.enableButton(),d.controlButton.enableButton(),C.notify("lalala"),u.raceButton.enableButton()}}));if(!t)throw new Error("no promised winner found");const e=t.filter(n=>n!==void 0);console.log(e);const s=[];for(let n=0;n<=e.length;n++){const a=e[n];a!==void 0&&s.push(a.time)}if((s==null?void 0:s.length)>0){const n=Math.min(...s),a=document.body,m=new b,B=new A;a.append(B.node,m.node),b.winnerModalText.node.textContent=`aaaannnd... winner is name finished in ${n} \\o/ 🧙‍♂️`,b.cross.node.addEventListener("click",()=>{m.destroy(),b.cross.destroy(),B.destroy()}),B.node.addEventListener("click",()=>{m.destroy(),b.cross.destroy(),B.destroy()})}}pickWitch(t,e){if(!t.target)throw new Error("no pick button found out there");h.indexForUpdate=e.id,d.controlName.node.value=e.name,d.controlColor.node.value=e.color}flyBack(t,e){if(!t.target)throw new Error("no back button found out there");e.node.style.animation="unset"}flyWitch(t,e,s){if(!t.target)throw new Error("no fly button found out there");e.node.style.animationName="witch_fly_anim",e.node.style.animationIterationCount="1",e.node.style.animationFillMode="forwards",e.node.style.animationTimingFunction="ease-in-out",(async()=>{try{const a=await G(s).then(m=>m.velocity);e.node.style.animationDuration=`${+window.innerWidth*.8/+a}s`}catch{throw new Error("smth wrong went with getting time")}})(),U(s)}plusWitches(){for(let n=0;n<100;n++)H(this.getRandomName(),this.getRandomColor());(async()=>{try{const n=await x();if(!n)throw new Error("no witches encounted");N.node.textContent=`Currently total brooms' count is ${n}`}catch{throw new Error("smth wrong went with total count")}})();let{currentWitches:s}=h;s+=100,h.currentWitches=s}countWitches(t,e,s){if(!t.target)throw new Error("no del button found out there");ot(e),s-=1,N.node.textContent=`Currently total brooms' count is ${s}`,this.node.textContent="",h.currentWitches=s}createNameModal(t){const e=new o({tagName:"div",classList:["cross"]});if(l.controlName.node.value===""){const s=new A,n=new W;n.node.textContent=`you skipped imagining name then now '${t}' is the name`,setTimeout(()=>{s.destroy(),n.destroy()},4e3),n.node.append(e.node),s.node.addEventListener("click",()=>{s.destroy(),n.destroy(),e.destroy()}),e.node.addEventListener("click",()=>{s.destroy(),n.destroy(),e.destroy()})}}createWitchByClickOnCreate(){const t=this.ifInputName(l.controlName.node.value);l.controlName.node.value===""&&this.createNameModal(t),H(t,l.controlColor.node.value),(async()=>{const n=await x();if(!n)throw new Error("no witches encounted");N.node.textContent=`Currently total brooms' count is ${n}`})();let{currentWitches:s}=h;s+=1,h.currentWitches=s,setTimeout(()=>{l.controlName.node.value=""},100)}static enablePagination(){i.paginationButtonBeginning.enableButton(),i.paginationButtonLeft.enableButton(),i.paginationButtonRight.enableButton(),i.paginationButtonEnd.enableButton()}enableButtons(){u.resetButton.enableButton(),u.moreWitchesButton.enableButton(),l.controlButton.enableButton(),d.controlButton.enableButton(),u.raceButton.enableButton()}disableButtons(){P.subscribe(()=>{this.justDisableButtons()})}justDisableButtons(){i.paginationButtonBeginning.disableButton(),i.paginationButtonLeft.disableButton(),i.paginationButtonRight.disableButton(),i.paginationButtonEnd.disableButton(),u.resetButton.disableButton(),u.moreWitchesButton.disableButton(),l.controlButton.disableButton(),d.controlButton.disableButton()}};p.witchesArrayHTML=[];let S=p;class i extends o{constructor(){super({tagName:"div",classList:["race_pagination"]}),i.paginationButtonBeginning=new o({tagName:"button",classList:["race_pagination_button"]}),i.paginationButtonBeginning.enableButton(),i.paginationButtonBeginning.setCursorPointer(),i.paginationButtonLeft=new o({tagName:"button",classList:["race_pagination_button"]}),i.paginationButtonLeft.enableButton(),i.paginationButtonLeft.setCursorPointer(),i.paginationButtonLeft.node.addEventListener("click",()=>{this.turnPageRight()}),i.paginationButtonNumber=new o({tagName:"button",classList:["race_pagination_button"]}),i.paginationButtonNumber.node.textContent=`${h.currentPage}`,i.paginationButtonRight=new o({tagName:"button",classList:["race_pagination_button"]}),i.paginationButtonRight.enableButton(),i.paginationButtonRight.setCursorPointer(),i.paginationButtonRight.node.addEventListener("click",()=>{this.turnPageLeft()}),i.paginationButtonEnd=new o({tagName:"button",classList:["race_pagination_button"]}),i.paginationButtonEnd.enableButton(),i.paginationButtonEnd.setCursorPointer(),I.subscribe(()=>{i.paginationButtonBeginning.enableButton(),i.paginationButtonLeft.enableButton(),i.paginationButtonRight.enableButton(),i.paginationButtonEnd.enableButton()}),this.node.append(i.paginationButtonBeginning.node,i.paginationButtonLeft.node,i.paginationButtonNumber.node,i.paginationButtonRight.node,i.paginationButtonEnd.node)}turnPageLeft(){const e=h.currentWitches,s=Math.ceil(e/7);h.currentPage<s&&(i.paginationButtonNumber.node.textContent="",h.currentPage+=1,i.paginationButtonNumber.node.textContent=`${h.currentPage}`,$[0].value=String(h.currentPage))}turnPageRight(){const e=h.currentWitches,s=Math.ceil(e/7);h.currentPage<s&&(i.paginationButtonNumber.node.textContent="",h.currentPage-=1,i.paginationButtonNumber.node.textContent=`${h.currentPage}`,$[0].value=String(h.currentPage))}}class wt extends o{constructor(){super({tagName:"div",classList:["quidditch"]}),this.store=h;const t=new rt,e=new u;(async()=>{try{const w=await x();if(!w)throw new Error("no witches encounted");N.node.textContent=`Currently total brooms' count is ${w}`}catch{throw new Error("smth actually wrong with witches count")}})();const n=new S,a=new i,m=new o({tagName:"div",classList:["quidditch_warning"],textContent:"Using magic wands during brooms racing is strictly probihited."}),B=new o({tagName:"div",classList:["quidditch_wrapper"],children:[t,e,N,n,a,m]});this.node.append(B.node)}}class gt extends o{constructor(){super({tagName:"div",classList:["winners"]});const t=new o({tagName:"div",classList:["winners_number"],textContent:"№"}),e=new o({tagName:"div",classList:["winners_pic"],textContent:"Pic"}),s=new o({tagName:"div",classList:["winners_name"],textContent:"Name"}),n=new o({tagName:"div",classList:["winners_wins"],textContent:"Wins"}),a=new o({tagName:"div",classList:["winners_time"],textContent:"Best Time"}),m=new o({tagName:"div",classList:["winners_line"],children:[t,e,s,n,a]});this.winnersTable=new o({tagName:"div",classList:["winners_table"],children:[m]}),this.totalNumberOfWinners=new o({tagName:"div",classList:["winners_total_number"]}),(async()=>{try{const w=await st();if(!w)throw new Error("no witches encounted");this.totalNumberOfWinners.node.textContent=`Total Number of Winners is ${w}`}catch{throw new Error("smth actually wrong with winners count")}})(),this.node.append(this.totalNumberOfWinners.node,this.winnersTable.node)}}class pt extends o{constructor(){super({tagName:"div",classList:["footer"]});const t=new o({tagName:"a",classList:["footer_rsschool"],textContent:"RSSchool"});t.addLink("https://rs.school/"),t.node.style.marginRight="1vw";const e=new o({tagName:"a",classList:["footer_year"],textContent:"2023"}),s=new o({tagName:"div",classList:["footer_year_rs_wrapper"],children:[t,e]}),n=new o({tagName:"a",classList:["footer_author"],textContent:"lyutails"});n.addLink("https://github.com/lyutails");const a=new o({tagName:"div",classList:["footer_wrapper"],children:[s,n]});this.node.append(a.node)}}class T extends o{constructor(){super({tagName:"a",classList:["header_button"]})}}class L extends o{constructor(){super({tagName:"div",classList:["header"]});const t=new T;t.addTextContent("Parking Lot"),t.addLink(`#${g.BroomParking}`);const e=new T;e.addTextContent("Quidditch"),e.addLink(`#${g.Quidditch}`);const s=new T;s.addTextContent("Winners"),s.addLink(`#${g.Winners}`);const n=new o({tagName:"div",classList:["header_buttons"],children:[t,e,s]});L.headerSnitch=new o({tagName:"a",classList:["header_snitch"]}),L.headerSnitch.addLink(`#${g.Quidditch}`);const a=new o({tagName:"div",classList:["header_wrapper"],children:[n,L.headerSnitch]});this.node.append(a.node)}}class c{constructor(){this.raceBody=document.body;const t=new L,e=new pt;c.quidditch=new wt,c.notFound=new _,c.winners=new gt,c.broomsParking=new K,c.pageBody=new o({tagName:"div",classList:["page_body"]}),c.pageBody.append(c.quidditch),c.run(),this.raceBody.append(t.node,c.pageBody.node,e.node)}static renderNewView(t){c.pageBody.node.textContent="",t===""&&c.pageBody.append(c.quidditch),t===g.Quidditch&&c.pageBody.append(c.quidditch),t===g.BroomParking&&c.pageBody.append(c.broomsParking),t===g.Winners&&c.pageBody.append(c.winners),t===g.NotFound&&c.pageBody.append(c.notFound),t!==g.Quidditch&&t!==g.BroomParking&&t!==g.Winners&&t!==""&&c.pageBody.append(c.notFound)}static enableRouteChange(){window.addEventListener("hashchange",()=>{const t=window.location.hash.slice(1);c.renderNewView(t)}),window.addEventListener("DOMContentLoaded",()=>{const t=window.location.hash.slice(1);c.renderNewView(t)})}static run(){c.renderNewView(g.Quidditch),c.enableRouteChange()}}new c;
