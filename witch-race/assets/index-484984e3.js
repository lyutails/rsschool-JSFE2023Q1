(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();const M=["maple","spruce","elder","birch","pine","cedar","sakura","sequoia","whomping willow","oak","appletree","aspen","bamboo","rosehip","nickel","ivy"],_=["2000","Repaired","Gold","Access","Way","Thorns","Elven","Twist","Rooftop","2023","Twice Repaired","Platina","Sparkles","Marathon","Wind's Wings","Wind's Song","Scorpion","Meow","Waterproof","Firebreath","Glitch","No Trace","Pick","Naked","Hurricane","Silent","Dragon"],S=["Nimbus","School Broomstick","Firebolt","Phantom","Moonlight Strike","Ghost Broom","Silverrain","Tashenka","Cherry","Tornado","Abyss","Tails","Butterfly","Colibri","Night Star","Myth","Crab","Phenomenon","Salute","Rumours","Raven"];class n{constructor({tagName:t,classList:e=[""],textContent:s="",children:a=[]}){this.append=(...i)=>{this.node.append(...i.map(u=>u.node))},this.node=document.createElement(t??"div"),this.node.classList.add(...e),this.node.textContent=s,a.length&&this.append(...a)}destroy(){this.node.remove()}addTextContent(t){this.node.textContent=t}addMoreClasses(t){this.node.classList.add(t)}removeClass(t){this.node.classList.remove(t)}toggleClass(t){this.node.classList.toggle(t)}addLink(t){this.node.setAttribute("href",t)}setPlaceholder(t){this.node.setAttribute("placeholder",t)}randomizeOwl(t){return t[Math.floor(Math.random()*t.length)]}disableButton(){this.node.setAttribute("disabled","")}enableButton(){this.node.removeAttribute("disabled")}setCursorPointer(){this.node.hasAttribute("disabled")&&(this.node.style.cursor="pointer"),this.node.style.cursor="default"}getRandomName(){const t=S[Math.floor(Math.random()*S.length)],e=_[Math.floor(Math.random()*_.length)],s=M[Math.floor(Math.random()*M.length)];return`${t} ${e} ${s}`}getRandomColor(){const t="0123456789abcdef";let e="#";for(let s=0;s<6;s++)e+=t[Math.floor(Math.random()*16)];return e}ifInputName(t){return t===""?this.getRandomName():t}}class I extends n{constructor(){super({tagName:"div",classList:["brooms_parking"]});const t=new n({tagName:"div",classList:["parking_sign"]}),e=new n({tagName:"div",classList:["parking_cat"]}),s=new n({tagName:"div",classList:["brooms_wrapper"],children:[t,e]});this.node.append(s.node)}}class K extends n{constructor(){super({tagName:"div",classList:["not_found"]});const t=new n({tagName:"div",classList:["not_found_wrapper"],textContent:"Highly likely you got lost in the castle - try another staircase leading to the quidditch field, brooms parking or winners room."});this.node.append(t.node)}}class G{constructor(){this.observers=[]}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(e=>e!==t)}notify(t){this.observers.forEach(e=>{e(t)})}}const H=new G,l={_currentWitches:4,currentWitchesObserver:H,_indexForUpdate:0,_currentUpdate:0,_currentPage:1,set currentWitches(o){this._currentWitches=o,this.currentWitchesObserver.notify("lalala")},get currentWitches(){return this._currentWitches},set indexForUpdate(o){this._indexForUpdate=o},get indexForUpdate(){return this._indexForUpdate},set currentUpdate(o){this._currentUpdate=o,this.currentWitchesObserver.notify("lalala")},get currentUpdate(){return this._currentUpdate},set currentPage(o){this._currentPage=o,this.currentWitchesObserver.notify("lalala")},get currentPage(){return this._currentPage}};class A extends n{constructor(){super({tagName:"div",classList:["brooms_count"]}),this.node.textContent="Currently total brooms' count is paste-here-number."}}const N=new A;class U extends n{constructor(){super({tagName:"div",classList:["control_widget_button"]})}}class c extends n{constructor(){super({tagName:"div",classList:["control_widget"]}),c.controlName=new n({tagName:"input",classList:["control_widget_name"]}),c.controlName.setPlaceholder("Imagine Name"),c.controlName.node.value="",c.controlName.node.setAttribute("type","text"),c.controlColor=new n({tagName:"input",classList:["control_widget_color"]}),c.controlColor.node.setAttribute("type","color"),c.controlColor.node.value="#55c6a8",c.controlButton=new U,c.controlButton.node.textContent="Create",this.node.append(c.controlName.node,c.controlColor.node,c.controlButton.node)}}var g=(o=>(o.Quidditch="quidditch",o.BroomParking="brooms_parking",o.Winners="winners",o.NotFound="404",o))(g||{}),k=(o=>(o.garage="/garage",o.winners="/winners",o.engine="/engine",o))(k||{}),E=(o=>(o.OK="200",o.STOP="500",o.notFound="404",o))(E||{});const T="http://127.0.0.1:3000",b=`${T}${k.garage}`;`${T}${k.winners}`;const O=`${T}${k.engine}`,X="7",C=[{key:"_page",value:`${l.currentPage}`},{key:"_limit",value:X}],z=new G,V=async o=>{const e=await fetch(`${b}?${(a=>a.map(i=>`${i.key}=${i.value}`).join("&"))(o)}`);if(!e.ok)throw new Error("some error happened on the way");return await e.json()},Y=async o=>fetch(`${b}/${o}`,{method:"GET"}).then(t=>t.json()),F=async(o,t)=>{try{return await fetch(`${b}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,color:t})}).then(s=>s.json())}catch{throw new Error("failed to create new witch")}},Z=async(o,t,e)=>fetch(`${b}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,color:t})}).then(s=>(E.OK in s&&Y(e),s.json())),tt=async o=>{await fetch(`${O}?&id=${o}&status=stopped`,{method:"PATCH"}).then(t=>t.json())},J=async o=>{await fetch(`${O}?&id=${o}&status=drive`,{method:"PATCH"}).then(t=>(console.log(t),t.status===+E.STOP&&(tt(o),z.notify("lalala")),t.json()))},$=async o=>fetch(`${O}?&id=${o}&status=started`,{method:"PATCH"}).then(t=>t.json()).then(t=>t),et=async(o,t,e)=>{Promise.all(o).then(s=>s.forEach(()=>{(async()=>{const i=await $(t).then(u=>u.velocity);e.node.style.animationDuration=`${+window.innerWidth*.8/+i}s`})()})).then(()=>{e.node.style.animationName="witch_fly_anim",e.node.style.animationIterationCount="1",e.node.style.animationFillMode="forwards",e.node.style.animationTimingFunction="ease-in-out",J(t)})},nt=async o=>await(await fetch(`${b}/${o}`,{method:"DELETE"})).json(),W=async()=>{const o=fetch(`${b}?_page=1&_limit=1`);if(!o)throw new Error("no witches found");return o.then(e=>e.headers.get("X-Total-Count")||"0")};class d extends n{constructor(){super({tagName:"div",classList:["control_widget"]}),d.controlName=new n({tagName:"input",classList:["control_widget_name"]}),d.controlName.setPlaceholder("Customize Name"),d.controlName.node.setAttribute("type","text"),d.controlColor=new n({tagName:"input",classList:["control_widget_color"]}),d.controlColor.node.setAttribute("type","color"),d.controlColor.node.value="#55c6a8",d.controlButton=new U,d.controlButton.node.textContent="Update",d.controlButton.node.onclick=()=>{d.updateWitchHandler()},this.node.append(d.controlName.node,d.controlColor.node,d.controlButton.node)}static updateWitchHandler(){Z(`${d.controlName.node.value}`,`${d.controlColor.node.value}`,l.indexForUpdate),setTimeout(()=>{d.controlName.node.value=""},100),l.currentUpdate+=1}}class ot extends n{constructor(){super({tagName:"div",classList:["control_panel"]});const t=new c,e=new d;this.node.append(t.node,e.node)}}class m extends n{constructor(){super({tagName:"div",classList:["race_buttons"]}),m.raceButton=new n({tagName:"div",classList:["race_buttons_button"],textContent:"Race"}),m.resetButton=new n({tagName:"div",classList:["race_buttons_button"],textContent:"Reset"}),m.moreWitchesButton=new n({tagName:"div",classList:["race_buttons_button"],textContent:"More Witches"}),this.node.append(m.raceButton.node,m.resetButton.node,m.moreWitchesButton.node)}}class st extends n{constructor(){super({tagName:"div",classList:["race_pagination"]}),this.paginationButtonBeginning=new n({tagName:"button",classList:["race_pagination_button"]}),this.paginationButtonBeginning.enableButton(),this.paginationButtonBeginning.setCursorPointer(),this.paginationButtonLeft=new n({tagName:"button",classList:["race_pagination_button"]}),this.paginationButtonLeft.enableButton(),this.paginationButtonLeft.setCursorPointer(),this.paginationButtonLeft.node.addEventListener("click",()=>{this.turnPageRight()}),this.paginationButtonNumber=new n({tagName:"button",classList:["race_pagination_button"]}),this.paginationButtonNumber.node.textContent=`${l.currentPage}`,this.paginationButtonRight=new n({tagName:"button",classList:["race_pagination_button"]}),this.paginationButtonRight.enableButton(),this.paginationButtonRight.setCursorPointer(),this.paginationButtonRight.node.addEventListener("click",()=>{this.turnPageLeft()}),this.paginationButtonEnd=new n({tagName:"button",classList:["race_pagination_button"]}),this.paginationButtonEnd.enableButton(),this.paginationButtonEnd.setCursorPointer(),this.node.append(this.paginationButtonBeginning.node,this.paginationButtonLeft.node,this.paginationButtonNumber.node,this.paginationButtonRight.node,this.paginationButtonEnd.node)}turnPageLeft(){const e=l.currentWitches,s=Math.ceil(e/7);l.currentPage<s&&(this.paginationButtonNumber.node.textContent="",l.currentPage+=1,this.paginationButtonNumber.node.textContent=`${l.currentPage}`,C[0].value=String(l.currentPage))}turnPageRight(){const e=l.currentWitches,s=Math.ceil(e/7);l.currentPage<s&&(this.paginationButtonNumber.node.textContent="",l.currentPage-=1,this.paginationButtonNumber.node.textContent=`${l.currentPage}`,C[0].value=String(l.currentPage))}}class L extends n{constructor(){super({tagName:"div",classList:["track_buttons_button"]})}}class R extends n{constructor(){super({tagName:"div",classList:["track_buttons"]}),this.flyButton=new L,this.flyButton.node.textContent="Fly",this.backButton=new L,this.backButton.node.textContent="Back",this.pickButton=new L,this.pickButton.node.textContent="Pick",this.delButton=new L,this.delButton.node.textContent="Del",this.node.append(this.flyButton.node,this.backButton.node,this.pickButton.node,this.delButton.node)}}class q extends n{constructor(){super({tagName:"div",classList:["track"]})}}class j extends n{constructor(){super({tagName:"div",classList:["witch"]})}}class Q extends n{constructor(){super({tagName:"div",classList:["owl"]})}}const at="/lyutails-JSFE2023Q1/witch-race/assets/halloween-horror-owl-1ecda387.svg",it="/lyutails-JSFE2023Q1/witch-race/assets/halloween-horror-owl_polar-234b501c.svg",D=[at,it];class B extends n{constructor(){super({tagName:"div",classList:["imagined_name_modal"],textContent:"you skipped imagining name then now lalala is the name"}),B.cross=new n({tagName:"div",classList:["cross"]}),this.node.append(B.cross.node),document.body.append(this.node)}}class rt extends n{constructor(){super({tagName:"div",classList:["overlay"]}),document.body.append(this.node)}}class h extends n{constructor(){super({tagName:"div",classList:["track_wrapper"]}),this.store=l,this.countWitchesAfterDelete=async(t,e,s)=>{if(!await W())throw new Error("no witches encounted");t.delButton.node.onclick=i=>this.countWitches(i,e,s)},H.subscribe(()=>{setTimeout(()=>{this.render()},100)}),setTimeout(()=>{this.render()},100)}render(){this.node.textContent="";let{currentWitches:t}=this.store;V(C).then(e=>e.forEach((s,a)=>{const i=new j,u=new Q;u.node.style.backgroundImage=`url('${u.randomizeOwl(D)}')`,h.broomWitchName=new n({tagName:"div",classList:["track_broom_witch_name"]});const y=new n({tagName:"div",classList:["track_path"],children:[i,u]}),w=new q,p=new R,v=new n({tagName:"div",classList:["track_buttons_and_name"],children:[p,h.broomWitchName]});i.node.style.backgroundColor=s.color,h.broomWitchName.node.textContent=s.name,a=s.id,p.pickButton.node.setAttribute("id",`${a}`),p.pickButton.node.onclick=P=>this.pickWitch(P,s),p.flyButton.node.onclick=P=>this.flyWitch(P,i,a),m.raceButton.node.onclick=()=>et(e,a,i),this.countWitchesAfterDelete(p,a,t),this.node.append(y.node,w.node,v.node)})),c.controlButton.node.addEventListener("click",()=>{const e=new j;e.node.style.backgroundColor=c.controlColor.node.value,h.broomWitchName=new n({tagName:"div",classList:["track_broom_witch_name"]}),h.broomWitchName.node.textContent=this.ifInputName(c.controlName.node.value);const s=this.ifInputName(c.controlName.node.value);h.broomWitchName.node.textContent=s;const a=new Q;a.node.style.backgroundImage=`url('${a.randomizeOwl(D)}')`;const i=new n({tagName:"div",classList:["track_path"],children:[e,a]}),u=new q,y=new R,w=new n({tagName:"div",classList:["track_buttons_and_name"],children:[y,h.broomWitchName]});if(this.node.append(i.node,u.node,w.node),t+=1,(async()=>{const v=await W();if(!v)throw new Error("no witches encounted");N.node.textContent=`Currently total brooms' count is ${v}`})(),h.broomWitchName.node.textContent)F(h.broomWitchName.node.textContent,c.controlColor.node.value),setTimeout(()=>{c.controlName.node.value=""},100);else throw new Error("no name generated");this.createNameModal(s)}),m.moreWitchesButton.node.onclick=()=>this.plusWitches()}pickWitch(t,e){if(!t.target)throw new Error("no pick button found out there");l.indexForUpdate=e.id,d.controlName.node.value=e.name,d.controlColor.node.value=e.color}flyWitch(t,e,s){if(!t.target)throw new Error("no fly button found out there");e.node.style.animationName="witch_fly_anim",e.node.style.animationIterationCount="1",e.node.style.animationFillMode="forwards",e.node.style.animationTimingFunction="ease-in-out",$(s),(async()=>{const i=await $(s).then(u=>u.velocity);e.node.style.animationDuration=`${+window.innerWidth*.8/+i}s`})(),J(s),z.subscribe(()=>{e.node.style.animationPlayState="paused"})}plusWitches(){for(let s=0;s<100;s++)F(this.getRandomName(),this.getRandomColor());let{currentWitches:e}=l;e+=100,N.node.textContent=`Currently total brooms' count is ${e}`,this.node.textContent="",l.currentWitches=e}countWitches(t,e,s){if(!t.target)throw new Error("no del button found out there");nt(e),s-=1,N.node.textContent=`Currently total brooms' count is ${s}`,this.node.textContent="",l.currentWitches=s}createNameModal(t){const e=new n({tagName:"div",classList:["cross"]});if(c.controlName.node.value===""){const s=new rt,a=new B;a.node.textContent=`you skipped imagining name then now '${t}' is the name`,setTimeout(()=>{s.destroy(),a.destroy()},4e3),a.node.append(e.node),s.node.addEventListener("click",()=>{s.destroy(),a.destroy(),e.destroy()}),e.node.addEventListener("click",()=>{s.destroy(),a.destroy(),e.destroy()})}}}class ct extends n{constructor(){super({tagName:"div",classList:["quidditch"]}),this.store=l;const t=new ot,e=new m;(async()=>{const w=await W();if(!w)throw new Error("no witches encounted");N.node.textContent=`Currently total brooms' count is ${w}`})();const a=new h,i=new st,u=new n({tagName:"div",classList:["quidditch_warning"],textContent:"Using magic wands during brooms racing is strictly probihited."}),y=new n({tagName:"div",classList:["quidditch_wrapper"],children:[t,e,N,a,i,u]});this.node.append(y.node)}}class dt extends n{constructor(){super({tagName:"div",classList:["winners"]});const t=new n({tagName:"div",classList:["winners_number"],textContent:"№"}),e=new n({tagName:"div",classList:["winners_pic"],textContent:"Pic"}),s=new n({tagName:"div",classList:["winners_name"],textContent:"Name"}),a=new n({tagName:"div",classList:["winners_wins"],textContent:"Wins"}),i=new n({tagName:"div",classList:["winners_time"],textContent:"Best Time"}),u=new n({tagName:"div",classList:["winners_line"],children:[t,e,s,a,i]});this.winnersTable=new n({tagName:"div",classList:["winners_table"],children:[u]}),this.totalNumberOfWinners=new n({tagName:"div",classList:["winners_total_number"],textContent:"Total Number of Winners is ~paste amount here~"}),this.node.append(this.totalNumberOfWinners.node,this.winnersTable.node)}}class lt extends n{constructor(){super({tagName:"div",classList:["footer"]});const t=new n({tagName:"a",classList:["footer_rsschool"],textContent:"RSSchool"});t.addLink("https://rs.school/"),t.node.style.marginRight="1vw";const e=new n({tagName:"a",classList:["footer_year"],textContent:"2023"}),s=new n({tagName:"div",classList:["footer_year_rs_wrapper"],children:[t,e]}),a=new n({tagName:"a",classList:["footer_author"],textContent:"lyutails"});a.addLink("https://github.com/lyutails");const i=new n({tagName:"div",classList:["footer_wrapper"],children:[s,a]});this.node.append(i.node)}}class x extends n{constructor(){super({tagName:"a",classList:["header_button"]})}}class f extends n{constructor(){super({tagName:"div",classList:["header"]});const t=new x;t.addTextContent("Parking Lot"),t.addLink(`#${g.BroomParking}`);const e=new x;e.addTextContent("Quidditch"),e.addLink(`#${g.Quidditch}`);const s=new x;s.addTextContent("Winners"),s.addLink(`#${g.Winners}`);const a=new n({tagName:"div",classList:["header_buttons"],children:[t,e,s]});f.headerSnitch=new n({tagName:"a",classList:["header_snitch"]}),f.headerSnitch.addLink(`#${g.Quidditch}`);const i=new n({tagName:"div",classList:["header_wrapper"],children:[a,f.headerSnitch]});this.node.append(i.node)}}class r{constructor(){this.raceBody=document.body;const t=new f,e=new lt;r.quidditch=new ct,r.notFound=new K,r.winners=new dt,r.broomsParking=new I,r.pageBody=new n({tagName:"div",classList:["page_body"]}),r.pageBody.append(r.quidditch),r.run(),this.raceBody.append(t.node,r.pageBody.node,e.node)}static renderNewView(t){r.pageBody.node.textContent="",t===""&&r.pageBody.append(r.quidditch),t===g.Quidditch&&r.pageBody.append(r.quidditch),t===g.BroomParking&&r.pageBody.append(r.broomsParking),t===g.Winners&&r.pageBody.append(r.winners),t===g.NotFound&&r.pageBody.append(r.notFound)}static enableRouteChange(){window.addEventListener("hashchange",()=>{const t=window.location.hash.slice(1);r.renderNewView(t)}),window.addEventListener("DOMContentLoaded",()=>{const t=window.location.hash.slice(1);r.renderNewView(t)})}static run(){r.renderNewView(g.Quidditch),r.enableRouteChange()}}new r;
