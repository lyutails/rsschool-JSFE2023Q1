(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const D=["maple","spruce","elder","birch","pine","cedar","sakura","sequoia","whomping willow","oak","appletree","aspen","bamboo","rosehip","nickel","ivy"],Q=["2000","Repaired","Gold","Access","Way","Thorns","Elven","Twist","Rooftop","2023","Twice Repaired","Platina","Sparkles","Marathon","Wind's Wings","Wind's Song","Scorpion","Meow","Waterproof","Firebreath","Glitch","No Trace","Pick","Naked","Hurricane","Silent","Dragon"],j=["Nimbus","School Broomstick","Firebolt","Phantom","Moonlight Strike","Ghost Broom","Silverrain","Tashenka","Cherry","Tornado","Abyss","Tails","Butterfly","Colibri","Night Star","Myth","Crab","Phenomenon","Salute","Rumours","Raven"];class o{constructor({tagName:t,classList:e=[""],textContent:n="",children:s=[]}){this.append=(...i)=>{this.node.append(...i.map(m=>m.node))},this.node=document.createElement(t??"div"),this.node.classList.add(...e),this.node.textContent=n,s.length&&this.append(...s)}destroy(){this.node.remove()}addTextContent(t){this.node.textContent=t}addMoreClasses(t){this.node.classList.add(t)}removeClass(t){this.node.classList.remove(t)}toggleClass(t){this.node.classList.toggle(t)}addLink(t){this.node.setAttribute("href",t)}setPlaceholder(t){this.node.setAttribute("placeholder",t)}randomizeOwl(t){return t[Math.floor(Math.random()*t.length)]}disableButton(){this.node.setAttribute("disabled","")}enableButton(){this.node.removeAttribute("disabled")}setCursorPointer(){this.node.hasAttribute("disabled")&&(this.node.style.cursor="pointer"),this.node.style.cursor="default"}getRandomName(){const t=j[Math.floor(Math.random()*j.length)],e=Q[Math.floor(Math.random()*Q.length)],n=D[Math.floor(Math.random()*D.length)];return`${t} ${e} ${n}`}getRandomColor(){const t="0123456789abcdef";let e="#";for(let n=0;n<6;n++)e+=t[Math.floor(Math.random()*16)];return e}ifInputName(t){return t===""?this.getRandomName():t}}class z extends o{constructor(){super({tagName:"div",classList:["brooms_parking"]});const t=new o({tagName:"div",classList:["parking_sign"]}),e=new o({tagName:"div",classList:["parking_cat"]}),n=new o({tagName:"div",classList:["brooms_wrapper"],children:[t,e]});this.node.append(n.node)}}class I extends o{constructor(){super({tagName:"div",classList:["not_found"]});const t=new o({tagName:"div",classList:["not_found_wrapper"],textContent:"Highly likely you got lost in the castle - try another staircase leading to the quidditch field, brooms parking or winners room."});this.node.append(t.node)}}class b{constructor(){this.observers=[]}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(e=>e!==t)}notify(t){this.observers.forEach(e=>{e(t)})}}const U=new b,l={_currentWitches:4,currentWitchesObserver:U,_indexForUpdate:0,_currentUpdate:0,_currentPage:1,_currentWinnersPage:1,set currentWitches(a){this._currentWitches=a,this.currentWitchesObserver.notify("lalala")},get currentWitches(){return this._currentWitches},set indexForUpdate(a){this._indexForUpdate=a},get indexForUpdate(){return this._indexForUpdate},set currentUpdate(a){this._currentUpdate=a,this.currentWitchesObserver.notify("lalala")},get currentUpdate(){return this._currentUpdate},set currentPage(a){this._currentPage=a,this.currentWitchesObserver.notify("lalala")},get currentPage(){return this._currentPage},set currentWinnersPage(a){this._currentWinnersPage=a},get currentWinnersPage(){return this._currentWinnersPage}};class K extends o{constructor(){super({tagName:"div",classList:["brooms_count"]}),this.node.textContent="Currently total brooms' count is paste-here-number."}}const y=new K;class G extends o{constructor(){super({tagName:"button",classList:["control_widget_button"]})}}class u extends o{constructor(){super({tagName:"div",classList:["control_widget"]}),u.controlName=new o({tagName:"input",classList:["control_widget_name"]}),u.controlName.setPlaceholder("Imagine Name"),u.controlName.node.value="",u.controlName.node.setAttribute("type","text"),u.controlColor=new o({tagName:"input",classList:["control_widget_color"]}),u.controlColor.node.setAttribute("type","color"),u.controlColor.node.value="#55c6a8",u.controlButton=new G,u.controlButton.node.textContent="Create",this.node.append(u.controlName.node,u.controlColor.node,u.controlButton.node)}}var g=(a=>(a.Quidditch="quidditch",a.BroomParking="brooms_parking",a.Winners="winners",a.NotFound="404",a))(g||{}),C=(a=>(a.garage="/garage",a.winners="/winners",a.engine="/engine",a))(C||{});const F="http://127.0.0.1:3000",N=`${F}${C.garage}`;`${F}${C.winners}`;const q=`${F}${C.engine}`,X="7",$=[{key:"_page",value:`${l.currentPage}`},{key:"_limit",value:X}];class L extends o{constructor(){super({tagName:"button",classList:["track_buttons_button"]})}}const T=new b,k=new b,O=new b;class Y extends o{constructor(){super({tagName:"div",classList:["track_buttons"]}),this.flyButton=new L,this.flyButton.node.textContent="Fly",this.backButton=new L,this.backButton.node.textContent="Back",this.backButton.disableButton(),this.pickButton=new L,this.pickButton.node.textContent="Pick",this.delButton=new L,this.delButton.node.textContent="Del",this.node.append(this.flyButton.node,this.backButton.node,this.pickButton.node,this.delButton.node),T.subscribe(()=>{this.flyButton.disableButton(),this.backButton.disableButton(),this.pickButton.disableButton(),this.delButton.disableButton()}),k.subscribe(()=>{this.backButton.enableButton(),this.pickButton.enableButton(),this.delButton.enableButton()}),O.subscribe(()=>{this.flyButton.enableButton(),this.backButton.disableButton()})}}class h extends o{constructor(){super({tagName:"div",classList:["race_buttons"]}),h.raceButton=new o({tagName:"button",classList:["race_buttons_button"],textContent:"Race"}),h.resetButton=new o({tagName:"button",classList:["race_buttons_button"],textContent:"Reset"}),h.moreWitchesButton=new o({tagName:"button",classList:["race_buttons_button"],textContent:"More Witches"}),this.node.append(h.raceButton.node,h.resetButton.node,h.moreWitchesButton.node)}}class Z extends o{constructor(){super({tagName:"div",classList:["track"]})}}class A extends o{constructor(){super({tagName:"div",classList:["witch"]})}}class V extends o{constructor(){super({tagName:"div",classList:["owl"]})}}const R="/lyutails-JSFE2023Q1/witch-race/assets/halloween-horror-owl-1ecda387.svg",tt="/lyutails-JSFE2023Q1/witch-race/assets/halloween-horror-owl_polar-234b501c.svg",et=[R,tt];class x extends o{constructor(){super({tagName:"div",classList:["imagined_name_modal"],textContent:"you skipped imagining name then now lalala is the name"}),x.cross=new o({tagName:"div",classList:["cross"]}),this.node.append(x.cross.node),document.body.append(this.node)}}class nt extends o{constructor(){super({tagName:"div",classList:["overlay"]}),document.body.append(this.node)}}const P=new b,ot=new b,J=new b;class p extends o{constructor(){super({tagName:"div",classList:["track_wrapper"]}),this.store=l,this.countWitchesAfterDelete=async(t,e,n)=>{try{if(!await v())throw new Error("no witches encounted");t.delButton.node.onclick=i=>this.countWitches(i,e,n)}catch{throw new Error("smth went wrotn with count after delete")}},this.flyAllWitches=(t,e,n)=>{if(!t.target)throw new Error("no fly button found out there");const s=S(e).then(i=>i.velocity);n.node.style.animationDuration=`${+window.innerWidth*.8/+s}s`,n.node.style.animationName="witch_fly_anim",n.node.style.animationIterationCount="1",n.node.style.animationFillMode="forwards",n.node.style.animationTimingFunction="ease-in-out",M(e,n)},U.subscribe(()=>{setTimeout(()=>{this.render()},100)}),setTimeout(()=>{this.render()},100)}render(){this.node.textContent="";const{currentWitches:t}=this.store;st($).then(e=>e.forEach(n=>{const s=new A,i=new V;i.node.style.backgroundImage=`url('${i.randomizeOwl(et)}')`,p.broomWitchName=new o({tagName:"div",classList:["track_broom_witch_name"]});const m=new o({tagName:"div",classList:["track_path"],children:[s,i]}),W=new Z,w=new Y,_=new o({tagName:"div",classList:["track_buttons_and_name"],children:[w,p.broomWitchName]});s.node.style.backgroundColor=n.color,p.broomWitchName.node.textContent=n.name,s.node.id=String(n.id),w.pickButton.node.id=String(n.id),this.node.append(m.node,W.node,_.node),w.pickButton.node.onclick=B=>this.pickWitch(B,n),w.flyButton.node.onclick=B=>{this.flyWitch(B,s,n.id),P.notify(this.disableButtons()),T.notify("lalala"),h.raceButton.disableButton(),window.addEventListener("animationend",()=>{p.enablePagination(),ot.notify(this.enableButtons()),k.notify("lalala"),h.raceButton.enableButton()})},w.backButton.node.onclick=B=>{this.flyBack(B,s),O.notify("lalala"),J.notify("lalala")},h.raceButton.node.addEventListener("click",()=>{ct(e,n.id,s),P.notify(this.disableButtons()),T.notify("lalala"),h.raceButton.disableButton(),window.addEventListener("animationend",()=>{this.enableButtons(),k.notify("lalala")})}),h.resetButton.node.addEventListener("click",()=>{s.node.style.animation="unset",O.notify("lalala")}),this.countWitchesAfterDelete(w,n.id,t)})),u.controlButton.node.onclick=()=>{this.createWitchByClickOnCreate()},h.moreWitchesButton.node.onclick=()=>this.plusWitches()}pickWitch(t,e){if(!t.target)throw new Error("no pick button found out there");l.indexForUpdate=e.id,d.controlName.node.value=e.name,d.controlColor.node.value=e.color}flyBack(t,e){if(!t.target)throw new Error("no back button found out there");e.node.style.animation="unset"}flyWitch(t,e,n){if(!t.target)throw new Error("no fly button found out there");e.node.style.animationName="witch_fly_anim",e.node.style.animationIterationCount="1",e.node.style.animationFillMode="forwards",e.node.style.animationTimingFunction="ease-in-out",(async()=>{try{const i=await S(n).then(m=>m.velocity);e.node.style.animationDuration=`${+window.innerWidth*.8/+i}s`}catch{throw new Error("smth wrong went with getting time")}})(),M(n,e)}plusWitches(){for(let s=0;s<100;s++)H(this.getRandomName(),this.getRandomColor());(async()=>{try{const s=await v();if(!s)throw new Error("no witches encounted");y.node.textContent=`Currently total brooms' count is ${s}`}catch{throw new Error("smth wrong went with total count")}})();let{currentWitches:n}=l;n+=100,l.currentWitches=n}countWitches(t,e,n){if(!t.target)throw new Error("no del button found out there");it(e),n-=1,y.node.textContent=`Currently total brooms' count is ${n}`,this.node.textContent="",l.currentWitches=n}createNameModal(t){const e=new o({tagName:"div",classList:["cross"]});if(u.controlName.node.value===""){const n=new nt,s=new x;s.node.textContent=`you skipped imagining name then now '${t}' is the name`,setTimeout(()=>{n.destroy(),s.destroy()},4e3),s.node.append(e.node),n.node.addEventListener("click",()=>{n.destroy(),s.destroy(),e.destroy()}),e.node.addEventListener("click",()=>{n.destroy(),s.destroy(),e.destroy()})}}createWitchByClickOnCreate(){const t=this.ifInputName(u.controlName.node.value);u.controlName.node.value===""&&this.createNameModal(t),H(t,u.controlColor.node.value),(async()=>{const s=await v();if(!s)throw new Error("no witches encounted");y.node.textContent=`Currently total brooms' count is ${s}`})();let{currentWitches:n}=l;n+=1,l.currentWitches=n,setTimeout(()=>{u.controlName.node.value=""},100)}static enablePagination(){r.paginationButtonBeginning.enableButton(),r.paginationButtonLeft.enableButton(),r.paginationButtonRight.enableButton(),r.paginationButtonEnd.enableButton()}enableButtons(){h.resetButton.enableButton(),h.moreWitchesButton.enableButton(),u.controlButton.enableButton(),d.controlButton.enableButton(),h.raceButton.enableButton()}disableButtons(){P.subscribe(()=>{this.justDisableButtons()})}justDisableButtons(){r.paginationButtonBeginning.disableButton(),r.paginationButtonLeft.disableButton(),r.paginationButtonRight.disableButton(),r.paginationButtonEnd.disableButton(),h.resetButton.disableButton(),h.moreWitchesButton.disableButton(),u.controlButton.disableButton(),d.controlButton.disableButton()}}class r extends o{constructor(){super({tagName:"div",classList:["race_pagination"]}),r.paginationButtonBeginning=new o({tagName:"button",classList:["race_pagination_button"]}),r.paginationButtonBeginning.enableButton(),r.paginationButtonBeginning.setCursorPointer(),r.paginationButtonLeft=new o({tagName:"button",classList:["race_pagination_button"]}),r.paginationButtonLeft.enableButton(),r.paginationButtonLeft.setCursorPointer(),r.paginationButtonLeft.node.addEventListener("click",()=>{this.turnPageRight()}),r.paginationButtonNumber=new o({tagName:"button",classList:["race_pagination_button"]}),r.paginationButtonNumber.node.textContent=`${l.currentPage}`,r.paginationButtonRight=new o({tagName:"button",classList:["race_pagination_button"]}),r.paginationButtonRight.enableButton(),r.paginationButtonRight.setCursorPointer(),r.paginationButtonRight.node.addEventListener("click",()=>{this.turnPageLeft()}),r.paginationButtonEnd=new o({tagName:"button",classList:["race_pagination_button"]}),r.paginationButtonEnd.enableButton(),r.paginationButtonEnd.setCursorPointer(),J.subscribe(()=>{r.paginationButtonBeginning.enableButton(),r.paginationButtonLeft.enableButton(),r.paginationButtonRight.enableButton(),r.paginationButtonEnd.enableButton()}),this.node.append(r.paginationButtonBeginning.node,r.paginationButtonLeft.node,r.paginationButtonNumber.node,r.paginationButtonRight.node,r.paginationButtonEnd.node)}turnPageLeft(){const e=l.currentWitches,n=Math.ceil(e/7);l.currentPage<n&&(r.paginationButtonNumber.node.textContent="",l.currentPage+=1,r.paginationButtonNumber.node.textContent=`${l.currentPage}`,$[0].value=String(l.currentPage))}turnPageRight(){const e=l.currentWitches,n=Math.ceil(e/7);l.currentPage<n&&(r.paginationButtonNumber.node.textContent="",l.currentPage-=1,r.paginationButtonNumber.node.textContent=`${l.currentPage}`,$[0].value=String(l.currentPage))}}const st=async a=>{const e=await fetch(`${N}?${(s=>s.map(i=>`${i.key}=${i.value}`).join("&"))(a)}`);if(!e.ok)throw new Error("some error happened on the way");return await e.json()},H=async(a,t)=>{await fetch(`${N}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,color:t})})},at=async(a,t,e)=>fetch(`${N}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,color:t})}),rt=async a=>{await fetch(`${q}?&id=${a}&status=stopped`,{method:"PATCH"}).then(t=>t.json()).catch(()=>{throw new Error("smth went wrong here")})},M=async(a,t)=>{fetch(`${q}?&id=${a}&status=drive`,{method:"PATCH"}).then(e=>e.json()).catch(()=>{t.node.style.animationPlayState="paused",rt(a),r.paginationButtonBeginning.enableButton(),r.paginationButtonLeft.enableButton(),r.paginationButtonRight.enableButton(),r.paginationButtonEnd.enableButton(),h.resetButton.enableButton(),h.moreWitchesButton.enableButton(),u.controlButton.enableButton(),d.controlButton.enableButton(),k.notify("lalala"),h.raceButton.enableButton()})},S=async a=>fetch(`${q}?&id=${a}&status=started`,{method:"PATCH"}).then(t=>t.json()).then(t=>t).catch(()=>{throw new Error("smth went wrong here")}),it=async a=>await(await fetch(`${N}/${a}`,{method:"DELETE"})).json(),v=async()=>{const a=fetch(`${N}?_page=1&_limit=1`);if(!a)throw new Error("no witches found");return a.then(e=>e.headers.get("X-Total-Count")||"0")},ct=async(a,t,e)=>{Promise.all(a).then(()=>{(async()=>{const s=await S(t).then(i=>i.velocity);e.node.style.animationDuration=`${+window.innerWidth*.8/+s}s`})(),e.node.style.animationName="witch_fly_anim",e.node.style.animationIterationCount="1",e.node.style.animationFillMode="forwards",e.node.style.animationTimingFunction="ease-in-out",M(t,e)}).catch(()=>{throw new Error("smth went wrong here")})};class d extends o{constructor(){super({tagName:"div",classList:["control_widget"]}),d.controlName=new o({tagName:"input",classList:["control_widget_name"]}),d.controlName.setPlaceholder("Customize Name"),d.controlName.node.setAttribute("type","text"),d.controlColor=new o({tagName:"input",classList:["control_widget_color"]}),d.controlColor.node.setAttribute("type","color"),d.controlColor.node.value="#55c6a8",d.controlButton=new G,d.controlButton.node.textContent="Update",d.controlButton.node.onclick=()=>{d.updateWitchHandler()},this.node.append(d.controlName.node,d.controlColor.node,d.controlButton.node)}static updateWitchHandler(){at(`${d.controlName.node.value}`,`${d.controlColor.node.value}`,l.indexForUpdate),setTimeout(()=>{d.controlName.node.value=""},100),l.currentUpdate+=1}}class dt extends o{constructor(){super({tagName:"div",classList:["control_panel"]});const t=new u,e=new d;this.node.append(t.node,e.node)}}class ut extends o{constructor(){super({tagName:"div",classList:["quidditch"]}),this.store=l;const t=new dt,e=new h;(async()=>{try{const w=await v();if(!w)throw new Error("no witches encounted");y.node.textContent=`Currently total brooms' count is ${w}`}catch{throw new Error("smth actually wrong with witches count")}})();const s=new p,i=new r,m=new o({tagName:"div",classList:["quidditch_warning"],textContent:"Using magic wands during brooms racing is strictly probihited."}),W=new o({tagName:"div",classList:["quidditch_wrapper"],children:[t,e,y,s,i,m]});this.node.append(W.node)}}class lt extends o{constructor(){super({tagName:"div",classList:["winners"]});const t=new o({tagName:"div",classList:["winners_number"],textContent:"№"}),e=new o({tagName:"div",classList:["winners_pic"],textContent:"Pic"}),n=new o({tagName:"div",classList:["winners_name"],textContent:"Name"}),s=new o({tagName:"div",classList:["winners_wins"],textContent:"Wins"}),i=new o({tagName:"div",classList:["winners_time"],textContent:"Best Time"}),m=new o({tagName:"div",classList:["winners_line"],children:[t,e,n,s,i]});this.winnersTable=new o({tagName:"div",classList:["winners_table"],children:[m]}),this.totalNumberOfWinners=new o({tagName:"div",classList:["winners_total_number"],textContent:"Total Number of Winners is ~paste amount here~"}),this.node.append(this.totalNumberOfWinners.node,this.winnersTable.node)}}class ht extends o{constructor(){super({tagName:"div",classList:["footer"]});const t=new o({tagName:"a",classList:["footer_rsschool"],textContent:"RSSchool"});t.addLink("https://rs.school/"),t.node.style.marginRight="1vw";const e=new o({tagName:"a",classList:["footer_year"],textContent:"2023"}),n=new o({tagName:"div",classList:["footer_year_rs_wrapper"],children:[t,e]}),s=new o({tagName:"a",classList:["footer_author"],textContent:"lyutails"});s.addLink("https://github.com/lyutails");const i=new o({tagName:"div",classList:["footer_wrapper"],children:[n,s]});this.node.append(i.node)}}class E extends o{constructor(){super({tagName:"a",classList:["header_button"]})}}class f extends o{constructor(){super({tagName:"div",classList:["header"]});const t=new E;t.addTextContent("Parking Lot"),t.addLink(`#${g.BroomParking}`);const e=new E;e.addTextContent("Quidditch"),e.addLink(`#${g.Quidditch}`);const n=new E;n.addTextContent("Winners"),n.addLink(`#${g.Winners}`);const s=new o({tagName:"div",classList:["header_buttons"],children:[t,e,n]});f.headerSnitch=new o({tagName:"a",classList:["header_snitch"]}),f.headerSnitch.addLink(`#${g.Quidditch}`);const i=new o({tagName:"div",classList:["header_wrapper"],children:[s,f.headerSnitch]});this.node.append(i.node)}}class c{constructor(){this.raceBody=document.body;const t=new f,e=new ht;c.quidditch=new ut,c.notFound=new I,c.winners=new lt,c.broomsParking=new z,c.pageBody=new o({tagName:"div",classList:["page_body"]}),c.pageBody.append(c.quidditch),c.run(),this.raceBody.append(t.node,c.pageBody.node,e.node)}static renderNewView(t){c.pageBody.node.textContent="",t===""&&c.pageBody.append(c.quidditch),t===g.Quidditch&&c.pageBody.append(c.quidditch),t===g.BroomParking&&c.pageBody.append(c.broomsParking),t===g.Winners&&c.pageBody.append(c.winners),t===g.NotFound&&c.pageBody.append(c.notFound),t!==g.Quidditch&&t!==g.BroomParking&&t!==g.Winners&&t!==""&&c.pageBody.append(c.notFound)}static enableRouteChange(){window.addEventListener("hashchange",()=>{const t=window.location.hash.slice(1);c.renderNewView(t)}),window.addEventListener("DOMContentLoaded",()=>{const t=window.location.hash.slice(1);c.renderNewView(t)})}static run(){c.renderNewView(g.Quidditch),c.enableRouteChange()}}new c;
